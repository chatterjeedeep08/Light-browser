<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Minimal Browser</title>
    <style>
        * {
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        #main {
            display: flex;
            flex-direction: column;
            height: 100%;
            position: relative;
        }

        /* Container for toolbar AND toggle so they animate together */
        #toolbar-wrapper {
            overflow: hidden;
            transition: height 0.3s ease;
        }

        /* Toolbar itself */
        #toolbar {
            display: flex;
            padding: 10px;
            background-color: #222;
            gap: 10px;
        }

        /* Address input */
        #urlInput {
            flex: 1;
            padding: 8px;
            border-radius: 5px;
            border: none;
        }

        /* Go button */
        #goButton {
            padding: 8px 12px;
            background-color: #555;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #toolbar button {
            padding: 8px 12px;
            background-color: #555;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #backButton,
        #forwardButton {
            min-width: 40px;
        }

        /* Toggle arrow */
        #toggleArrow {
            position: absolute;
            top: calc(var(--toolbar-height, 60px) - 12px);
            right: 20px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: #333;
            color: white;
            font-size: 14px;
            cursor: pointer;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: top 0.3s ease;
        }

        /* Webview stays full height minus the toolbar */
        #webview {
            flex: 1;
        }

        .loader {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid white;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 0.8s linear infinite;
            vertical-align: middle;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div id="main">
        <div id="toolbar-wrapper">
            <div id="toolbar">
                <input type="text" id="urlInput" placeholder="Enter URL" />
                <button id="backButton">⬅</button>
                <button id="goButton">Go</button>
                <button id="forwardButton">➡</button>
            </div>
        </div>
        <button id="toggleArrow">⬆</button>
        <webview id="webview" src="https://www.google.com/"></webview>
    </div>
    <script>
        const urlInput = document.getElementById('urlInput');
        const goButton = document.getElementById('goButton');
        const backButton = document.getElementById('backButton');
        const forwardButton = document.getElementById('forwardButton');
        const webview = document.getElementById('webview');
        const toolbarWrapper = document.getElementById('toolbar-wrapper');
        const toolbar = document.getElementById('toolbar');
        const toggleArrow = document.getElementById('toggleArrow');
        let isToolbarVisible = true;

        function formatURL(url) {
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                if (url.startsWith('www.')) {
                    url = 'https://' + url;
                } else if (url.includes('.')) {
                    url = 'https://www.' + url;
                } else {
                    url = 'https://www.google.com/search?q=' + encodeURIComponent(url);
                }
                return url;
            }
            return url;
        }

        function setLoadingState(isLoading) {
            if (isLoading) {
                goButton.disabled = true;
                goButton.innerHTML = `<span class="loader"></span>`;
            } else {
                goButton.disabled = false;
                goButton.innerText = 'Go';
            }
        }

        function updateNavButtons() {
            backButton.disabled = !webview.canGoBack();
            forwardButton.disabled = !webview.canGoForward();
            if (backButton.disabled) {
                backButton.innerHTML = '<span style="color: grey;">⬅</span>';
            } else {
                backButton.innerHTML = '⬅'
            }
            if (forwardButton.disabled) {
                forwardButton.innerHTML = '<span style="color: grey;">➡</span>';
            } else {
                forwardButton.innerHTML = '➡';
            }
        }
        const updateToolbarState = () => {
            const toolbarHeight = toolbar.scrollHeight;
            document.documentElement.style.setProperty('--toolbar-height', `${toolbarHeight}px`);
            if (isToolbarVisible) {
                toolbarWrapper.style.height = `${toolbarHeight}px`;
                toggleArrow.innerText = '⬆';
                toggleArrow.style.top = `${toolbarHeight - 12}px`;
            } else {
                toolbarWrapper.style.height = '0px';
                toggleArrow.innerText = '⬇';
                toggleArrow.style.top = '-12px';
            }
        };
        toggleArrow.addEventListener('click', () => {
            isToolbarVisible = !isToolbarVisible;
            updateToolbarState();
        });
        window.addEventListener('DOMContentLoaded', () => {
            updateToolbarState();
        });
        goButton.addEventListener('click', () => {
            webview.loadURL(formatURL(urlInput.value));
        });
        backButton.addEventListener('click', () => {
            if (webview.canGoBack()) {
                webview.goBack();
            }
        });
        forwardButton.addEventListener('click', () => {
            if (webview.canGoForward()) {
                webview.goForward();
            }
        });
        urlInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                webview.loadURL(formatURL(urlInput.value));
            }
        });
        const updateUrlBar = (event) => {
            urlInput.value = event.url;
        };
        webview.addEventListener('did-navigate', (e) => {
            urlInput.value = e.url;
            updateUrlBar(e);
            updateNavButtons(e);
        });
        // Update on various navigation events
        webview.addEventListener('did-navigate-in-page', (e) => {
            updateUrlBar(e);
            updateNavButtons(e);
        });
        webview.addEventListener('did-start-loading', () => {
            // Optional: show loading indicator
            setLoadingState(true);
        });
        webview.addEventListener('did-stop-loading', () => {
            // Optional: hide loading indicator
            setLoadingState(false);
        });
        webview.addEventListener('did-fail-load', (e) => {
            console.error('Failed to load:', e.errorDescription);
            setLoadingState(false);
        });
        webview.addEventListener('dom-ready', updateNavButtons);
    </script>
</body>

</html>